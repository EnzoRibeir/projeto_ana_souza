<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Painel Admin - Ana Souza</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">

  <style>
    body { background-color: #f8f9fa; }
    .navbar-dark { background-color: #212529 !important; }
    .table-actions button, .table-actions form { display: inline-block; margin-right: 5px; }
    .tab-content { margin-top: 20px; }
    .search-bar { max-width: 300px; }
    .nav-link.active { border-bottom: 3px solid #0d6efd; font-weight: 600; }
  </style>
</head>

<body>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
    <div class="container-fluid">
      <a class="navbar-brand fw-bold" href="#">Admin Ana Souza</a>
      <div class="collapse navbar-collapse">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
          <li class="nav-item">
            <a class="nav-link {% if aba == 'usuarios' %}active{% endif %}" href="{{ url_for('admin', aba='usuarios') }}">Usuários</a>
          </li>
          <li class="nav-item">
            <a class="nav-link {% if aba == 'produtos' %}active{% endif %}" href="{{ url_for('admin', aba='produtos') }}">Produtos</a>
          </li>
          <li class="nav-item">
            <a class="nav-link {% if aba == 'pedidos' %}active{% endif %}" href="{{ url_for('admin', aba='pedidos') }}">Pedidos</a>
          </li>
          <li class="nav-item">
            <a class="nav-link {% if aba == 'posts' %}active{% endif %}" href="{{ url_for('admin', aba='posts') }}">Posts</a>
          </li>
        </ul>
        <a href="{{ url_for('logout') }}" class="btn btn-outline-light">Logout</a>
      </div>
    </div>
  </nav>

  <div class="container" style="padding-top: 80px;">
    <div class="tab-content">

      <!-- ========== USUÁRIOS ========== -->
      <div class="tab-pane fade {% if aba == 'usuarios' %}show active{% endif %}" id="usuarios">
        <div class="d-flex justify-content-between align-items-center my-3">
          <h3>Usuários</h3>
          <input type="text" class="form-control search-bar" id="searchUsuarios" placeholder="Buscar usuário...">
          <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#addUsuarioModal">Adicionar</button>
        </div>

        <table class="table table-hover align-middle">
          <thead class="table-light">
            <tr>
              <th>Nome</th>
              <th>Email</th>
              <th>Telefone</th>
              <th>Data Nascimento</th>
              <th>Ações</th>
            </tr>
          </thead>
          <tbody id="usuariosTable">
            {% for u in usuarios %}
            <tr>
              <td>{{ u.nome }}</td>
              <td>{{ u.email }}</td>
              <td>{{ u.telefone }}</td>
              <td>{{ u.data_nascimento }}</td>
              <td class="table-actions">
                <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#editUsuarioModal{{ u.id }}">Editar</button>
                <form action="{{ url_for('delete_usuario', id=u.id) }}" method="POST" style="display:inline;">
                  <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Tem certeza que deseja deletar este usuário?');">
                    Deletar
                  </button>
                </form>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <!-- ========== PRODUTOS ========== -->
      <div class="tab-pane fade {% if aba == 'produtos' %}show active{% endif %}" id="produtos">
        <div class="d-flex justify-content-between align-items-center my-3">
          <h3>Produtos</h3>
          <input type="text" class="form-control search-bar" id="searchProdutos" placeholder="Buscar produto...">
          <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#addProdutoModal">Adicionar</button>
        </div>

        <table class="table table-hover align-middle">
          <thead class="table-light">
            <tr>
              <th>Nome</th>
              <th>Descrição</th>
              <th>Preço</th>
              <th>Estoque</th>
              <th>Cor</th>
              <th>Imagem</th>
              <th>Ações</th>
            </tr>
          </thead>
          <tbody id="produtosTable">
            {% for p in produtos %}
            <tr>
              <td>{{ p.nome }}</td>
              <td>{{ p.descricao }}</td>
              <td>R$ {{ "%.2f"|format(p.preco) }}</td>
              <td>{{ p.quantidade_estoque }}</td>
              <td>{{ p.cor }}</td>
              <td>{{ p.imagem }}</td>
              <td>
                <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#editProdutoModal{{ p.id }}">Editar</button>
                <a href="{{ url_for('delete_produto', id=p.id) }}" class="btn btn-danger btn-sm">Deletar</a>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <!-- ========== PEDIDOS ========== -->
      <div class="tab-pane fade {% if aba == 'pedidos' %}show active{% endif %}" id="pedidos">
        <div class="d-flex justify-content-between align-items-center my-3">
          <h3>Pedidos</h3>
          <input type="text" class="form-control search-bar" id="searchPedidos" placeholder="Buscar por status...">
          <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#addPedidoModal">Adicionar</button>
        </div>

        <table class="table table-hover align-middle">
          <thead class="table-light">
            <tr>
              <th>Usuário</th>
              <th>Status</th>
              <th>Data</th>
              <th>Total</th>
              <th>Ações</th>
            </tr>
          </thead>
          <tbody id="pedidosTable">
            {% for ped in pedidos %}
            <tr>
              <td>{{ ped.usuario.nome }}</td>
              <td>{{ ped.status }}</td>
              <td>{{ ped.data.strftime('%d/%m/%Y %H:%M') }}</td>
              <td>R$ {{ "%.2f"|format(ped.total()) }}</td>
              <td>
                <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#editPedidoModal{{ ped.id }}">Editar</button>
                <a href="{{ url_for('delete_pedido', id=ped.id) }}" class="btn btn-danger btn-sm">Deletar</a>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <!-- ========== POSTS ========== -->
      <div class="tab-pane fade {% if aba == 'posts' %}show active{% endif %}" id="posts">
        <div class="d-flex justify-content-between align-items-center my-3">
          <h3>Posts</h3>
          <input type="text" class="form-control search-bar" id="searchPosts" placeholder="Buscar post...">
          <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#addPostModal">Adicionar</button>
        </div>

        <table class="table table-hover align-middle">
          <thead class="table-light">
            <tr>
              <th>Título</th>
              <th>Subtítulo</th>
              <th>Autor</th>
              <th>Data</th>
              <th>Imagem</th>
              <th>Ações</th>
            </tr>
          </thead>
          <tbody id="postsTable">
            {% for post in posts %}
            <tr>
              <td>{{ post.titulo }}</td>
              <td>{{ post.subtitulo }}</td>
              <td>{{ post.autor }}</td>
              <td>{{ post.data_publicacao }}</td>
              <td>{{ post.imagem }}</td>
              <td>
                <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#editPostModal{{ post.id }}">Editar</button>
                <a href="{{ url_for('delete_post', id=post.id) }}" class="btn btn-danger btn-sm">Deletar</a>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

    </div>
  </div>

  {% include 'modais_admin.html' %}

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // ======== Filtros de busca por aba ========
    function aplicarBusca(inputId, tableId) {
      const input = document.getElementById(inputId);
      const table = document.getElementById(tableId);
      if (!input || !table) return;
      input.addEventListener("keyup", function() {
        const filtro = input.value.toLowerCase();
        const linhas = table.getElementsByTagName("tr");
        for (let i = 0; i < linhas.length; i++) {
          const texto = linhas[i].innerText.toLowerCase();
          linhas[i].style.display = texto.includes(filtro) ? "" : "none";
        }
      });
    }

    aplicarBusca("searchUsuarios", "usuariosTable");
    aplicarBusca("searchProdutos", "produtosTable");
    aplicarBusca("searchPedidos", "pedidosTable");
    aplicarBusca("searchPosts", "postsTable");
  </script>
</body>
</html>
